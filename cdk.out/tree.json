{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.224.0"},"children":{"LMDataPublisherBaseStack":{"id":"LMDataPublisherBaseStack","path":"LMDataPublisherBaseStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.224.0"},"children":{"CDKMetadata":{"id":"CDKMetadata","path":"LMDataPublisherBaseStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"},"children":{"Default":{"id":"Default","path":"LMDataPublisherBaseStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.224.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"LMDataPublisherBaseStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.224.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"LMDataPublisherBaseStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.224.0"}}}},"LMDataPublisherStorageStack":{"id":"LMDataPublisherStorageStack","path":"LMDataPublisherStorageStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.224.0"},"children":{"DataLakeKey":{"id":"DataLakeKey","path":"LMDataPublisherStorageStack/DataLakeKey","constructInfo":{"fqn":"aws-cdk-lib.aws_kms.Key","version":"2.224.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LMDataPublisherStorageStack/DataLakeKey/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_kms.CfnKey","version":"2.224.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::KMS::Key","aws:cdk:cloudformation:props":{"description":"KMS key for S3 data lake bucket encryption","enableKeyRotation":true,"keyPolicy":{"Statement":[{"Action":"kms:*","Effect":"Allow","Principal":{"AWS":{"Fn::Join":["",["arn:aws:iam::",{"Ref":"AWS::AccountId"},":root"]]}},"Resource":"*"}],"Version":"2012-10-17"}}}}}},"DataLakeKeyAlias":{"id":"DataLakeKeyAlias","path":"LMDataPublisherStorageStack/DataLakeKeyAlias","constructInfo":{"fqn":"aws-cdk-lib.aws_kms.Alias","version":"2.224.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LMDataPublisherStorageStack/DataLakeKeyAlias/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_kms.CfnAlias","version":"2.224.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::KMS::Alias","aws:cdk:cloudformation:props":{"aliasName":"alias/lm-datapublisher-datalake","targetKeyId":{"Fn::GetAtt":["DataLakeKey37130A3E","Arn"]}}}}}},"DataLakeBucket":{"id":"DataLakeBucket","path":"LMDataPublisherStorageStack/DataLakeBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.224.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LMDataPublisherStorageStack/DataLakeBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.224.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketEncryption":{"serverSideEncryptionConfiguration":[{"serverSideEncryptionByDefault":{"sseAlgorithm":"aws:kms","kmsMasterKeyId":{"Fn::GetAtt":["DataLakeKey37130A3E","Arn"]}}}]},"lifecycleConfiguration":{"rules":[{"id":"transition-to-ia","status":"Enabled","transitions":[{"storageClass":"STANDARD_IA","transitionInDays":90},{"storageClass":"GLACIER","transitionInDays":180}]},{"expirationInDays":365,"id":"expire-old-data","status":"Enabled"}]},"publicAccessBlockConfiguration":{"blockPublicAcls":true,"blockPublicPolicy":true,"ignorePublicAcls":true,"restrictPublicBuckets":true}}}}}},"DataLakeBucketName":{"id":"DataLakeBucketName","path":"LMDataPublisherStorageStack/DataLakeBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.224.0"}},"DataLakeKmsKeyArn":{"id":"DataLakeKmsKeyArn","path":"LMDataPublisherStorageStack/DataLakeKmsKeyArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.224.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"LMDataPublisherStorageStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"},"children":{"Default":{"id":"Default","path":"LMDataPublisherStorageStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.224.0"}}}},"Exports":{"id":"Exports","path":"LMDataPublisherStorageStack/Exports","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"},"children":{"Output{\"Fn::GetAtt\":[\"DataLakeBucket0256EA8E\",\"Arn\"]}":{"id":"Output{\"Fn::GetAtt\":[\"DataLakeBucket0256EA8E\",\"Arn\"]}","path":"LMDataPublisherStorageStack/Exports/Output{\"Fn::GetAtt\":[\"DataLakeBucket0256EA8E\",\"Arn\"]}","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.224.0"}},"Output{\"Fn::GetAtt\":[\"DataLakeKey37130A3E\",\"Arn\"]}":{"id":"Output{\"Fn::GetAtt\":[\"DataLakeKey37130A3E\",\"Arn\"]}","path":"LMDataPublisherStorageStack/Exports/Output{\"Fn::GetAtt\":[\"DataLakeKey37130A3E\",\"Arn\"]}","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.224.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"LMDataPublisherStorageStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.224.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"LMDataPublisherStorageStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.224.0"}}}},"LMDataPublisherDeliveryStack":{"id":"LMDataPublisherDeliveryStack","path":"LMDataPublisherDeliveryStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.224.0"},"children":{"FirehoseRole":{"id":"FirehoseRole","path":"LMDataPublisherDeliveryStack/FirehoseRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.224.0","metadata":[]},"children":{"ImportFirehoseRole":{"id":"ImportFirehoseRole","path":"LMDataPublisherDeliveryStack/FirehoseRole/ImportFirehoseRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.224.0","metadata":[]}},"Resource":{"id":"Resource","path":"LMDataPublisherDeliveryStack/FirehoseRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.224.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"firehose.amazonaws.com"}}],"Version":"2012-10-17"},"description":"IAM role for Firehose delivery stream to write to S3"}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"LMDataPublisherDeliveryStack/FirehoseRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.224.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LMDataPublisherDeliveryStack/FirehoseRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.224.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:Abort*","s3:DeleteObject*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging"],"Effect":"Allow","Resource":[{"Fn::ImportValue":"LMDataPublisherStorageStack:ExportsOutputFnGetAttDataLakeBucket0256EA8EArn1F6EDADC"},{"Fn::Join":["",[{"Fn::ImportValue":"LMDataPublisherStorageStack:ExportsOutputFnGetAttDataLakeBucket0256EA8EArn1F6EDADC"},"/*"]]}]},{"Action":["kms:Decrypt","kms:DescribeKey","kms:Encrypt","kms:GenerateDataKey","kms:GenerateDataKey*","kms:ReEncrypt*"],"Effect":"Allow","Resource":{"Fn::ImportValue":"LMDataPublisherStorageStack:ExportsOutputFnGetAttDataLakeKey37130A3EArn565CC05E"}},{"Action":["logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":{"Fn::GetAtt":["FirehoseLogGroup1B45149B","Arn"]}}],"Version":"2012-10-17"},"policyName":"FirehoseRoleDefaultPolicyF034DFF7","roles":[{"Ref":"FirehoseRoleAA67C190"}]}}}}}}},"DeliveryStream":{"id":"DeliveryStream","path":"LMDataPublisherDeliveryStack/DeliveryStream","constructInfo":{"fqn":"aws-cdk-lib.aws_kinesisfirehose.CfnDeliveryStream","version":"2.224.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::KinesisFirehose::DeliveryStream","aws:cdk:cloudformation:props":{"deliveryStreamName":"lm-datapublisher-delivery","deliveryStreamType":"DirectPut","extendedS3DestinationConfiguration":{"bucketArn":{"Fn::ImportValue":"LMDataPublisherStorageStack:ExportsOutputFnGetAttDataLakeBucket0256EA8EArn1F6EDADC"},"roleArn":{"Fn::GetAtt":["FirehoseRoleAA67C190","Arn"]},"compressionFormat":"GZIP","bufferingHints":{"intervalInSeconds":180,"sizeInMBs":5},"dynamicPartitioningConfiguration":{"enabled":true},"processingConfiguration":{"enabled":true,"processors":[{"type":"MetadataExtraction","parameters":[{"parameterName":"MetadataExtractionQuery","parameterValue":"{\n      orgId: .orgId,\n      metric: .metric,\n      year: (.tsUnixMs / 1000 | strftime(\"%Y\")),\n      month: (.tsUnixMs / 1000 | strftime(\"%m\")),\n      day: (.tsUnixMs / 1000 | strftime(\"%d\")),\n      hour: (.tsUnixMs / 1000 | strftime(\"%H\"))\n    }"},{"parameterName":"JsonParsingEngine","parameterValue":"JQ-1.6"}]}]},"prefix":"data/orgId=!{partitionKeyFromQuery:orgId}/metric=!{partitionKeyFromQuery:metric}/!{partitionKeyFromQuery:year}/!{partitionKeyFromQuery:month}/!{partitionKeyFromQuery:day}/!{partitionKeyFromQuery:hour}/","errorOutputPrefix":"errors/!{firehose:error-output-type}/!{timestamp:yyyy/MM/dd}/","cloudWatchLoggingOptions":{"enabled":true,"logGroupName":"/aws/kinesisfirehose/lm-datapublisher-delivery","logStreamName":"S3Delivery"}}}}},"FirehoseLogGroup":{"id":"FirehoseLogGroup","path":"LMDataPublisherDeliveryStack/FirehoseLogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.224.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"LMDataPublisherDeliveryStack/FirehoseLogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.224.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":"/aws/kinesisfirehose/lm-datapublisher-delivery","retentionInDays":14}}}}},"DeliveryStreamName":{"id":"DeliveryStreamName","path":"LMDataPublisherDeliveryStack/DeliveryStreamName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.224.0"}},"DeliveryStreamArn":{"id":"DeliveryStreamArn","path":"LMDataPublisherDeliveryStack/DeliveryStreamArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.224.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"LMDataPublisherDeliveryStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"},"children":{"Default":{"id":"Default","path":"LMDataPublisherDeliveryStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.224.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"LMDataPublisherDeliveryStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.224.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"LMDataPublisherDeliveryStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.224.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"}}}}}